#!/usr/bin/env ruby

require 'optparse'
require 'video_converter'

################
# Option parsing
################

@options = VideoConverter::Converter::Options.new(
  false,
  false,
  true,
  VideoConverter::Converter::DEFAULT_FOLDER,
  VideoConverter::Converter::DEFAULT_LOG_FOLDER,
  VideoConverter::Converter::DEFAULT_OUTPUT_FOLDER
)

OptionParser.new do |opts|
  prefix = 'Usage: convert_videos'
  indent = ' ' * prefix.length

  opts.banner = "#{prefix} [-h|--help]\n" \
    "#{indent}[-v|--version]\n" \
    "#{indent}[-V|--[no-]verbose]\n" \
    "#{indent}[-F|--[no-]foreground]\n" \
    "#{indent}[--[no-]clean]\n" \
    "#{indent}[-f FOLDER|--folder=FOLDER]\n" \
    "#{indent}[-l LOG_FOLDER|--log-folder=LOG_FOLDER]\n" \
    "#{indent}[-o OUTPUT_FOLDER|--output-folder=OUTPUT_FOLDER]"

  opts.on '-h', '--help', 'Prints this help' do
    puts opts
    exit
  end

  opts.on '-v', '--version', 'Prints the version number' do
    puts "convert_videos: video_converter #{VideoConverter::VERSION}"
    exit
  end

  opts.on '-V', '--[no-]verbose', 'Prints extra information at times' do |v|
    @options.verbose = v
  end

  opts.on '-F', '--[no-]foreground', 'Run conversions in the foreground (default: background)' do |f|
    @options.foreground = f
  end

  opts.on '--[no-]clean', 'Remove source files after conversion (default: remove)' do |c|
    @options.clean = c
  end

  opts.on '-f FOLDER', '--folder=FOLDER', "Folder for source videos (String: default #{VideoConverter::Converter::DEFAULT_FOLDER})" do |f|
    @options.folder = f
  end

  opts.on '-l LOG_FOLDER', '--log-folder=LOG_FOLDER', "Folder for log files (String: default #{VideoConverter::Converter::DEFAULT_LOG_FOLDER})" do |l|
    @options.log_folder = l
  end

  opts.on '-o OUTPUT_FOLDER', '--output-folder=OUTPUT_FOLDER', "Folder for output files (String: default #{VideoConverter::Converter::DEFAULT_OUTPUT_FOLDER})" do |o|
    @options.output_folder = o
  end
end.parse!

converter = VideoConverter::Converter.new @options
converter.run
